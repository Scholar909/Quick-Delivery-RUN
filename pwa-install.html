<!-- Floating container -->
<div id="install-wrapper" style="position:fixed;bottom:30px;right:30px;z-index:9999;"></div>

<style>
/* === Install Button Styling === */
#install-btn {
  display: flex;
  align-items: center;
  gap: 10px;
  background: linear-gradient(135deg, #0f4e75, #ffb300);
  color: #fff;
  border: none;
  padding: 12px 20px;
  border-radius: 14px;
  font-size: 15px;
  font-weight: 600;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  cursor: grab;
  backdrop-filter: blur(6px);
  opacity: 0;
  transform: translateY(60px);
  transition: all 0.5s ease;
  user-select: none;
  position: fixed;
}

#install-btn.show {
  opacity: 1;
  transform: translateY(0);
}

#install-btn.hide {
  opacity: 0;
  transform: translateY(60px);
}

#install-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 25px rgba(15,78,117,0.4);
}
</style>

<script>
let deferredPrompt;
let autoHideTimeout;

// Wait for the install prompt
window.addEventListener("beforeinstallprompt", (e) => {
  e.preventDefault();
  deferredPrompt = e;
  showInstallButton();
});

// === Show / Hide Button ===
function showInstallButton() {
  const wrapper = document.getElementById("install-wrapper");
  if (!wrapper) return;

  if (!document.getElementById("install-btn")) {
    const btn = document.createElement("button");
    btn.id = "install-btn";
    btn.innerHTML = '<i class="fas fa-download"></i> Install App';
    wrapper.appendChild(btn);

    // Click = install
    btn.addEventListener("click", async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === "accepted") {
          console.log("✅ User installed the app");
        } else {
          console.log("❌ User dismissed install");
        }
        deferredPrompt = null;
        hideInstallButton();
      }
    });

    makeDraggable(btn);
  }

  const btn = document.getElementById("install-btn");
  btn.classList.add("show");
  btn.classList.remove("hide");

  clearTimeout(autoHideTimeout);
  autoHideTimeout = setTimeout(() => {
    hideInstallButton();
    setTimeout(() => {
      if (deferredPrompt) showInstallButton();
    }, 30000);
  }, 10000);
}

function hideInstallButton() {
  const btn = document.getElementById("install-btn");
  if (btn) {
    btn.classList.remove("show");
    btn.classList.add("hide");
  }
}

// === Drag Logic (smooth + screen bounds + pointer events) ===
function makeDraggable(el) {
  let isDragging = false;
  let startX, startY, offsetX, offsetY;

  el.addEventListener("pointerdown", (e) => {
    // Ignore right-click or multiple touches
    if (e.button !== 0) return;
    isDragging = true;
    const rect = el.getBoundingClientRect();
    offsetX = e.clientX - rect.left;
    offsetY = e.clientY - rect.top;
    el.setPointerCapture(e.pointerId);
    el.style.cursor = "grabbing";
  });

  el.addEventListener("pointermove", (e) => {
    if (!isDragging) return;
    const winW = window.innerWidth;
    const winH = window.innerHeight;
    const rect = el.getBoundingClientRect();
    let newX = e.clientX - offsetX;
    let newY = e.clientY - offsetY;

    // Keep within screen
    newX = Math.max(5, Math.min(newX, winW - rect.width - 5));
    newY = Math.max(5, Math.min(newY, winH - rect.height - 5));

    el.style.left = newX + "px";
    el.style.top = newY + "px";
    el.style.right = "auto";
    el.style.bottom = "auto";
  });

  el.addEventListener("pointerup", (e) => {
    isDragging = false;
    el.releasePointerCapture(e.pointerId);
    el.style.cursor = "grab";
  });
}
</script>

<!-- FontAwesome for the icon -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">